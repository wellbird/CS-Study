# 11. 네트워크계층(1) & 12. 네트워크계층(2)
## IP 주소 체계
-----
### IP
- V6
  - 128Bit 주소체계
  - 8Bit를 18진수로 표현
- V4
  - 32Bit 주소체계
  - 8Bit를 10진수로 표현

### 인간 주소 체계처럼 할당한다면?
- 주민등록번호
  - IP 갯수가 부족함
  - 만약 IP 갯수가 충분하더라도 개별 등록 엔트리수가 너무 많아서 기계가 감당을 하지 못함(라우팅 테이블의 용량이 너무 커짐)
- 우편 주소 체계
  - IP가 ISP에 따라 바뀔 수 있음
  - 고정 IP의 경우 모든 컴퓨터 설정을 바꿔야 함
  - IP 갯수가 부족함

### Subnet
- 하나의 네트워크가 분할되어 나눠진 작은 네트워크
- Subnet Mask 작업을 통해 Subnetting 수행
  - ex)
  - IP가 192.168.0.1이고 Subnet Mask가 255.255.255.0이라면
  - 네트워크의 범위는 192.168.0.0 ~ 192.168.0.255
- 목적
  - 네트워크를 운영중인 서비스의 규모에 맞게 분할
  - 낭비되는 IP주소 자원을 최소화
  - 네트워크의 규모를 줄여서 브로드 캐스팅으로 인한 부하를 줄임

### Classless Inter Domain Routing(CIDR)
- 계층적
- 계층 예외 가능(계층적이기만 하면 우편주소체계와 동일한 문제를 가짐)
- 사이더가 나오면서 Class 체계보다 더 유연하게 IP주소를 여러 네트워크 영역으로 나눌 수 있게 됨
- 단말 컴퓨터 라우팅시
  - Subnet이 동일하지 않는 경우 - Subnet 단위로 Routing
  - Subnet이 동일한 경우 - 단말로 Routing
- 조직(ISP, 학교, 회사, etc.)에서 IP를 쓸 경우
    - 서브넷을 할당
      - ex. xxx.xxx.xxx.0/24(Subnet의 Bit수 - Most Significant Bit부터)
    - 서브넷을 조각화
- 참고 - 사이더가 나오기 전 네트워크의 클래스 구분
  - ![Class](https://user-images.githubusercontent.com/111935711/230590434-65bf514c-a428-4d85-abf0-d21680b378ea.jpg)

### IP 할당
- ICANN
  - Internet Corporation for Assigned Name & Numbers
  - 국가인터넷주소자원관리 기구

- DHCP(Dynamic Host Config Protocol)
  - 호스트의 IP주소와 각종 TCP/IP 프로토콜의 기본 설정을 클라이언트에게 자동적으로 제공해주는 프로토콜
  - 네트워크 안에 컴퓨터에 자동으로 네임 서버 주소, IP주소, 게이트웨이 주소를 할당해주는 것을 의미하고, 해당 클라이언트에게 일정 기간 임대를 하는 동적 주소 할당 프로토콜
  - 장점
    - PC의 수가 많거나 PC 자체 변동사항이 많은 경우 IP 설정이 자동으로 되기 때문에 효율적으로 사용 가능
    - IP를 자동으로 할당해주기 때문에 IP 충돌을 막을 수 있음
  - 단점
    - DHCP 서버에 의존되기 때문에 서버가 다운되면 IP 할당이 제대로 이루어지지 않음
  - 구성
    - DHCP 서버
      - 네트워크 인터페이스를 위해서 IP주소를 가지고 있는 서버에서 실행되는 프로그램
      - 일정한 범위의 IP주소를 다른 클라이언트에게 할당하여 자동으로 설정하게 해주는 역할
      - 클라이언트에게 IP 할당 요청이 들어오면 IP를 부여해주고 할당 가능한 IP들을 관리
      - DHCP서버는 클라이언트에게 할당된 IP주소를 변경없이 유지해 줄 수 있음
    - DHCP 클라이언트
      - 네트워크 부팅과정에서 DHCP서버에 IP주소를 요청하고 이를 얻음
      - 시스템이 시작하면 DHCP서버에 자신의 시스템을 위한 IP주소를 요청
      - 서버로부터 IP주소를 부여받으면 TCP/IP 설정은 초기화되고 다른 호스트와 TCP/IP를 사용해서 통신
  - 절차
    - DHCP Discover
      - 방향 : 클라이언트 → 서버
      - 단말이 DHCP 서버를 찾기 위한 메시지
    - DHCP Offer
      - 방향 : 서버 → 클라이언트
      - DHCP 서버의 존재를 알림
      - 클라이언트에 할당할 IP 주소 정보를 포함한 다양한 네트워크 정보를 함께 실어서 클라이언트에 전달
    - DHCP Request
      - 방향 : 클라이언트 → 서버
      - 하나의 DHCP 서버를 선택하고 해당 서버에게 단말이 사용할 네트워크 정보를 요청
    - DHCP Ack
      - 방향 : 서버 → 클라이언트
      - DHCP 서버가 클라이언트에게 네트워크 정보를 전달해 주는 메시지(DHCP Offer의 네트워크 정보와 동일)

- NAT(Network Address Translation)
  - IP 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술
  - 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함
  - 내부 망에서는 사설 IP 주소를 사용하여 통신을 하고, 외부망과의 통신시에는 NAT를 거쳐 공인 IP 주소로 자동 변환
  - 목적
    - 인터넷의 공인 IP주소를 절약할 수 있음
    - 공공망과 연결되는 사용자들의 고유한 사설망을 침입자들로부터 보호할 수 있음
  - NAT에서는 사설 IP에 접근할 수 없기 때문에 서버에서 응답 패킷을 보낼 수 없음(사설 IP에 접근할 수 있다 하더라고 같은 사설 IP(사설 IP는 같은 서브넷만 아니라면 중복 가능)를 쓰는 호스트가 많기 때문에 패킷이 제대로 도작한다는 보장이 없음)
  - 응답을 받기 위해서 사설 IP를 공유기 고유 IP로 교체 후 매핑테이블을 구성
